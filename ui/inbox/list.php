<div class="card card-custom card-stretch">

    <div class="card-header row row-marginless align-items-center flex-wrap py-5 h-auto" data-type="">

        <div class="col-12 col-sm-6 col-xxl-4 order-2 order-xxl-1 d-flex flex-wrap align-items-center">
            <div class="d-flex align-items-center mr-1 my-2">
                <label data-inbox="group-select" class="checkbox checkbox-inline checkbox-primary mr-3">
                    <input type="checkbox">
                    <span class="symbol-label"></span>
                </label>
                <div class="dropdown">
                    <span class="btn btn-clean btn-icon btn-sm mr-1" data-toggle="dropdown">
                    <i class="ki ki-bold-arrow-down icon-sm"></i>
                    </span>
                    <div class="dropdown-menu dropdown-menu-left p-0 m-0 dropdown-menu-sm">
                        <ul class="navi py-3">
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-text">All</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-text">Read</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-text">Unread</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-text">Starred</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="#" class="navi-link">
                                    <span class="navi-text">Unstarred</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <span class="btn btn-clean btn-icon btn-sm mr-2" data-toggle="tooltip" title="" data-original-title="Reload list">
                    <i class="ki ki-refresh icon-1x"></i>
                </span>
            </div>
            <div class="align-items-center mr-1 my-2 header-menu">
                <span class="btn btn-default btn-icon btn-sm mr-2" data-toggle="tooltip" title="Archive" data-original-title="Archive">
                <span class="svg-icon svg-icon-md">

                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <rect x="0" y="0" width="24" height="24"></rect>
                <path d="M6,2 L18,2 C18.5522847,2 19,2.44771525 19,3 L19,12 C19,12.5522847 18.5522847,13 18,13 L6,13 C5.44771525,13 5,12.5522847 5,12 L5,3 C5,2.44771525 5.44771525,2 6,2 Z M7.5,5 C7.22385763,5 7,5.22385763 7,5.5 C7,5.77614237 7.22385763,6 7.5,6 L13.5,6 C13.7761424,6 14,5.77614237 14,5.5 C14,5.22385763 13.7761424,5 13.5,5 L7.5,5 Z M7.5,7 C7.22385763,7 7,7.22385763 7,7.5 C7,7.77614237 7.22385763,8 7.5,8 L10.5,8 C10.7761424,8 11,7.77614237 11,7.5 C11,7.22385763 10.7761424,7 10.5,7 L7.5,7 Z" fill="#000000" opacity="0.3"></path>
                <path d="M3.79274528,6.57253826 L12,12.5 L20.2072547,6.57253826 C20.4311176,6.4108595 20.7436609,6.46126971 20.9053396,6.68513259 C20.9668779,6.77033951 21,6.87277228 21,6.97787787 L21,17 C21,18.1045695 20.1045695,19 19,19 L5,19 C3.8954305,19 3,18.1045695 3,17 L3,6.97787787 C3,6.70173549 3.22385763,6.47787787 3.5,6.47787787 C3.60510559,6.47787787 3.70753836,6.51099993 3.79274528,6.57253826 Z" fill="#000000"></path>
                </g>
                </svg>

                </span>
                </span>
                <span class="btn btn-default btn-icon btn-sm mr-2 d-none" data-toggle="tooltip" title="" data-original-title="Spam">
                <span class="svg-icon svg-icon-md">

                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <rect x="0" y="0" width="24" height="24"></rect>
                <circle fill="#000000" opacity="0.3" cx="12" cy="12" r="10"></circle>
                <rect fill="#000000" x="11" y="7" width="2" height="8" rx="1"></rect>
                <rect fill="#000000" x="11" y="16" width="2" height="2" rx="1"></rect>
                </g>
                </svg>

                </span>
                </span>
                <span id="" class="btn btn-default btn-icon btn-sm mr-2 delete_message" data-toggle="tooltip" title="Delete" data-original-title="Delete" disabled>
                    <span class="svg-icon svg-icon-md">

                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <rect x="0" y="0" width="24" height="24"></rect>
                        <path d="M6,8 L6,20.5 C6,21.3284271 6.67157288,22 7.5,22 L16.5,22 C17.3284271,22 18,21.3284271 18,20.5 L18,8 L6,8 Z" fill="#000000" fill-rule="nonzero"></path>
                        <path d="M14,4.5 L14,4 C14,3.44771525 13.5522847,3 13,3 L11,3 C10.4477153,3 10,3.44771525 10,4 L10,4.5 L5.5,4.5 C5.22385763,4.5 5,4.72385763 5,5 L5,5.5 C5,5.77614237 5.22385763,6 5.5,6 L18.5,6 C18.7761424,6 19,5.77614237 19,5.5 L19,5 C19,4.72385763 18.7761424,4.5 18.5,4.5 L14,4.5 Z" fill="#000000" opacity="0.3"></path>
                        </g>
                        </svg>

                    </span>
                </span>
                <span class="btn btn-default btn-icon btn-sm mr-2 read_message" data-toggle="tooltip" title="Mark as read" data-original-title="Mark as read">
                    <span class="svg-icon svg-icon-md">

                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <rect x="0" y="0" width="24" height="24"></rect>
                        <path d="M15.9956071,6 L9,6 C7.34314575,6 6,7.34314575 6,9 L6,15.9956071 C4.70185442,15.9316381 4,15.1706419 4,13.8181818 L4,6.18181818 C4,4.76751186 4.76751186,4 6.18181818,4 L13.8181818,4 C15.1706419,4 15.9316381,4.70185442 15.9956071,6 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"></path>
                        <path d="M10.1818182,8 L17.8181818,8 C19.2324881,8 20,8.76751186 20,10.1818182 L20,17.8181818 C20,19.2324881 19.2324881,20 17.8181818,20 L10.1818182,20 C8.76751186,20 8,19.2324881 8,17.8181818 L8,10.1818182 C8,8.76751186 8.76751186,8 10.1818182,8 Z" fill="#000000"></path>
                        </g>
                        </svg>

                    </span>
                </span>
                <span class="btn btn-default btn-icon btn-sm mr-2 d-none" data-toggle="tooltip" title="" data-original-title="Move">
                    <span class="svg-icon svg-icon-md">

                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <rect x="0" y="0" width="24" height="24"></rect>
                        <path d="M3.5,21 L20.5,21 C21.3284271,21 22,20.3284271 22,19.5 L22,8.5 C22,7.67157288 21.3284271,7 20.5,7 L10,7 L7.43933983,4.43933983 C7.15803526,4.15803526 6.77650439,4 6.37867966,4 L3.5,4 C2.67157288,4 2,4.67157288 2,5.5 L2,19.5 C2,20.3284271 2.67157288,21 3.5,21 Z" fill="#000000" opacity="0.3"></path>
                        <path d="M10.782158,17.5100514 L15.1856088,14.5000448 C15.4135806,14.3442132 15.4720618,14.0330791 15.3162302,13.8051073 C15.2814587,13.7542388 15.2375842,13.7102355 15.1868178,13.6753149 L10.783367,10.6463273 C10.5558531,10.489828 10.2445489,10.5473967 10.0880496,10.7749107 C10.0307022,10.8582806 10,10.9570884 10,11.0582777 L10,17.097272 C10,17.3734143 10.2238576,17.597272 10.5,17.597272 C10.6006894,17.597272 10.699033,17.566872 10.782158,17.5100514 Z" fill="#000000"></path>
                        </g>
                        </svg>

                    </span>
                </span>
            </div>
        </div>


        <div class="col-xxl-3 d-flex order-1 order-xxl-2 align-items-center justify-content-center">
            <div class="input-group input-group-lg input-group-solid my-2">
                <input type="text" class="form-control pl-4" placeholder="Search Inbox...">
                <div class="input-group-append">
                <span class="input-group-text pr-3">
                <span class="svg-icon svg-icon-lg">

                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <rect x="0" y="0" width="24" height="24"></rect>
                <path d="M14.2928932,16.7071068 C13.9023689,16.3165825 13.9023689,15.6834175 14.2928932,15.2928932 C14.6834175,14.9023689 15.3165825,14.9023689 15.7071068,15.2928932 L19.7071068,19.2928932 C20.0976311,19.6834175 20.0976311,20.3165825 19.7071068,20.7071068 C19.3165825,21.0976311 18.6834175,21.0976311 18.2928932,20.7071068 L14.2928932,16.7071068 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"></path>
                <path d="M11,16 C13.7614237,16 16,13.7614237 16,11 C16,8.23857625 13.7614237,6 11,6 C8.23857625,6 6,8.23857625 6,11 C6,13.7614237 8.23857625,16 11,16 Z M11,18 C7.13400675,18 4,14.8659932 4,11 C4,7.13400675 7.13400675,4 11,4 C14.8659932,4 18,7.13400675 18,11 C18,14.8659932 14.8659932,18 11,18 Z" fill="#000000" fill-rule="nonzero"></path>
                </g>
                </svg>

                </span>
                </span>
                </div>
            </div>
        </div>


        <div class="col-12 col-sm-6 col-xxl-4 order-2 order-xxl-3 d-flex align-items-center justify-content-sm-end text-right my-2">

            <div class="d-flex align-items-center mr-2" data-toggle="tooltip" title="" data-original-title="Records per page">
                <input type="number" class="current_page d-none" value=<?php echo $page?> />
                <span class="text-muted font-weight-bold mr-2" data-toggle="dropdown"><?php echo ($page+1)?> - 10 of <?php echo count(($objmessage))?></span>
                <!-- <div class="dropdown-menu dropdown-menu-right p-0 m-0 dropdown-menu-sm">
                    <ul class="navi py-3">
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-text">20 per page</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link active">
                                <span class="navi-text">50 par page</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-text">100 per page</span>
                            </a>
                        </li>
                    </ul>
                </div> -->
            </div>

            <?php //if(count($objmessage)> 10):?>
                <span class="btn btn-default btn-icon btn-sm mr-2 page-move" data-toggle="tooltip" title="Previose page" data-original-title="Previose page" data-type ="prev_page">
                    <i class="ki ki-bold-arrow-back icon-sm"></i>
                </span>
                <span class="btn btn-default btn-icon btn-sm mr-2 page-move" data-toggle="tooltip" title="Next page" data-original-title="Next page" data-type ="next_page">
                    <i class="ki ki-bold-arrow-next icon-sm"></i>
                </span>
            <?php //endif;?>

            <!-- <div class="dropdown mr-2" data-toggle="tooltip" title="" data-original-title="Sort">
                <span class="btn btn-default btn-icon btn-sm" data-toggle="dropdown">
                <i class="flaticon2-console icon-1x"></i>
                </span>
                <div class="dropdown-menu dropdown-menu-right p-0 m-0 dropdown-menu-sm">
                    <ul class="navi py-3">
                        <li class="navi-item">
                            <a href="#" class="navi-link active">
                                <span class="navi-text">Newest</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-text">Olders</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-text">Unread</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div> -->


            <!-- <div class="dropdown" data-toggle="tooltip" title="" data-original-title="Settings">
                <span class="btn btn-default btn-icon btn-sm" data-toggle="dropdown">
                <i class="ki ki-bold-more-hor icon-1x"></i>
                </span>
                <div class="dropdown-menu dropdown-menu-right p-0 m-0 dropdown-menu-md">

                    <ul class="navi navi-hover py-5">
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                <i class="flaticon2-drop"></i>
                                </span>
                                <span class="navi-text">New Group</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                <i class="flaticon2-list-3"></i>
                                </span>
                                <span class="navi-text">Contacts</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                <i class="flaticon2-rocket-1"></i>
                                </span>
                                <span class="navi-text">Groups</span>
                                <span class="navi-link-badge">
                                <span class="label label-light-primary label-inline font-weight-bold">new</span>
                                </span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                <i class="flaticon2-bell-2"></i>
                                </span>
                                <span class="navi-text">Calls</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                            <span class="navi-icon">
                            <i class="flaticon2-gear"></i>
                            </span>
                                <span class="navi-text">Settings</span>
                            </a>
                        </li>
                        <li class="navi-separator my-3"></li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                            <span class="navi-icon">
                            <i class="flaticon2-magnifier-tool"></i>
                            </span>
                                <span class="navi-text">Help</span>
                            </a>
                        </li>
                        <li class="navi-item">
                            <a href="#" class="navi-link">
                                <span class="navi-icon">
                                <i class="flaticon2-bell-2"></i>
                                </span>
                                <span class="navi-text">Privacy</span>
                                <span class="navi-link-badge">
                                <span class="label label-light-danger label-rounded font-weight-bold">5</span>
                                </span>
                            </a>
                        </li>
                    </ul>

                </div>
            </div> -->

        </div>

    </div>


    <div class="card-body table-responsive px-0">
        
        <div class="list list-hover min-w-500px" data-inbox="list">
            <?php foreach ($objmessage as $obj): ?>
            <div class="d-flex align-items-start list-item card-spacer-x py-3" data-inbox="message" id="message_<?php echo $obj['id']?>">

                <div class="d-flex align-items-center">

                    <div class="d-flex align-items-center mr-3" data-inbox="actions" id="<?php echo $obj['id']?>">
                        <label class="checkbox checkbox-inline checkbox-primary flex-shrink-0 mr-3">
                            <input type="checkbox" value="<?php echo $obj['id']?>">
                            <span></span>
                        </label>
                        <a href="#" class="star-btn btn btn-icon btn-xs text-hover-warning active" data-toggle="tooltip" data-placement="right" title="Mark as important" data-original-title="Mark as important" data-id="<?php echo $obj['id']?>">
                            <?php
                                
                                $flagstatus = (trim($obj['markstatus']) =='1')? "text-warning":"text-mute";
                                $clstatus = (trim($obj['markstatus']) =='1')? "0":"1";

                            ?>
                            <i class="flaticon-star <?php echo $flagstatus;?>" data-status="<?php echo $clstatus;?>"></i>
                        </a>
                        <!-- <a href="#" class="btn btn-icon btn-xs text-hover-warning" data-toggle="tooltip" data-placement="right" title="Mark as important" data-original-title="Mark as important">
                            <i class="flaticon-add-label-button text-muted"></i>
                        </a> -->
                    </div>


                    <div class="d-flex align-items-center flex-wrap w-xxl-200px mr-3 detail-view" data-toggle="view">
                        <span class="symbol symbol-35 mr-3">
                            <span class="symbol-label" style="background-image:url( '/theme/assets/media/users/blank.png')"></span>
                            </span>
                            <span class="symbol-label" style="">
                                
                            </span>
                        </span>
                        <?php
                                
                            $readclass = (trim($obj['readstatus']) =='0')? "form-label":"";
                            $readstatus = (trim($obj['readstatus']) =='1')? "0":"1";

                        ?>
                        <a href="#" class="readstatus text-dark-75 text-hover-primary <?php echo $readclass;?>" data-status="<?php echo $readstatus;?>"><?php echo $obj["fromname"];?></a>
                        <span class="symbol-label ml-1 text-muted">
                            <?php $replycount = ($obj["replycount"]>0)?$obj["replycount"]:'';
                            echo $replycount;?>
                        </span>
                    </div>

                </div>


                <div class="flex-grow-1 mt-2 mr-2" data-toggle="view">
                    <div class="detail-view">
                        <span class="readstatus font-size-lg mr-2 <?php echo $readclass;?>"><?php echo $obj["subject"];?>
                            
                        </span>
                        <span class="text-muted">
                            <?php 
                            $content = strip_tags(html_entity_decode($obj["content"]));
                            if(strlen($content) > 150)
                                $content =substr($content,0,150)."...";
                            echo $content;
                            ?>
                                
                        </span>
                    </div>
                    <!-- <div class="mt-2">
                        <span class="label label-light-primary font-weight-bold label-inline mr-1">inbox</span>
                        <span class="label label-light-danger font-weight-bold label-inline">task</span>
                    </div> -->
                </div>


                <div class="mt-2 mr-3 font-weight-bolder w-50px text-right" data-toggle="view"><?php echo $obj->createdAt;?></div>

            </div>


           
        <?php endforeach; ?>

            
        </div>

    </div>

</div>
<script>

    $('#kt_inbox_list .list-item .checkbox input').on('click',function()
    {
        // if (this.checked) {
        //     $("#kt_inbox_list .header-menu").addClass("d-block");
        //     $("#kt_inbox_list .header-menu").removeClass("d-none");
        // }
        // else{
        //     $("#kt_inbox_list .header-menu").removeClass("d-block");
        //     $("#kt_inbox_list .header-menu").addClass("d-none");
                        
        // }               
        
        
    });

    $('#kt_inbox_list .list-item a.star-btn i').on('click',function()
    {
        
        var _postData = {
            id: "",
            status: "1"
        };
        var id = $(this).parent().attr("data-id");
        var status = $(this).attr("data-status");
        _postData.id  = id;
        _postData.status  = status;
        WebApp.post('inbox/postMark',_postData,fnCallbackPostStatus);
        
    });
    
    

    $('#kt_inbox_list .delete_message').on('click',function()
    {
        var checkedlist =$("#kt_inbox_list .list-item input:checkbox:checked").map(function(){  
            return $(this).val();
        }).get();
        
        var _postData = {
            messagedata: checkedlist
        };
        
        if(checkedlist.length > 0)
             WebApp.post('inbox/delMessage',_postData,fnCallbackDelMessage);
        else
            return false;
        
    });

    $('#kt_inbox_list .card-header .read_message').on('click',function()
    {
        
        var checkedlist =$("#kt_inbox_list .list-item input:checkbox:checked").map(function(){  
            return $(this).val();
        }).get();
        
        var _postData = {
            messagedata: checkedlist
        };
        
        if(checkedlist.length > 0)        
            WebApp.post('inbox/readMessage',_postData,fnCallbackReadMessage);
        else
            return false;
        
    });
    function fnCallbackReadMessage(webResponse)
    {
        if(webResponse.errorCode == 0)
        {

            (webResponse.data).forEach(function(element)
            {

                var clstatus = $("#message_"+element+" .readstatus").attr("data-status");
                if(clstatus =='1')
                {    clstatus = '0';}
                else
                {    clstatus = '1';}

                

                $("#message_"+element+" .readstatus").attr("data-status",clstatus);
                var status = $("#message_"+element+" .readstatus").attr("data-status");
                
                if(status =='1')
                {
                    
                    $("#message_"+element+" .readstatus").addClass("form-label");
                    
                }
                else
                {
                    $("#message_"+element+" .readstatus").removeClass("form-label");
                }
            })
        }
    }
    function fnCallbackDelMessage(webResponse)
    {
        if(webResponse.errorCode == 0)
        {
            (webResponse.data).forEach(function(element)
            {
                $("#message_"+element).remove();
            })
            
        }
    }
    function fnCallbackPostStatus(webResponse)
    {
        
        if(webResponse.errorCode == 0)
        {
            if(webResponse.message =='0')
            {
                $("#message_"+webResponse.data+" a.star-btn i").removeClass("text-warning");
                $("#message_"+webResponse.data+" a.star-btn i").addClass("text-muted");
            }
            else
            {
                $("#message_"+webResponse.data+" a.star-btn i").removeClass("text-muted");
                $("#message_"+webResponse.data+" a.star-btn i").addClass("text-warning");
            }
            
        }
    }
</script>